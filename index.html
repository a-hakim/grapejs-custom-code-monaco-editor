<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>GrapesJS Plugin Custom Code with Monaco Editor</title>
    <link href="https://unpkg.com/grapesjs/dist/css/grapes.min.css" rel="stylesheet">
    <script src="https://unpkg.com/grapesjs"></script>
    <style>
      body,
      html {
        height: 100%;
        margin: 0;
      }
    </style>
  </head>
  <body>

    <div id="gjs" style="height:0px; overflow:hidden">
      <div style="margin:100px 100px 25px; padding:25px; font:caption">
        <h2>GrapesJS Custom Code Plugin with Monaco Editor</h2>
        <p>This plugin now automatically loads Monaco Editor without requiring separate initialization.</p>
        <ul>
          <li>No need to manually load Monaco Editor scripts</li>
          <li>Fully integrated Monaco Editor initialization</li>
          <li>Automatic language detection and syntax highlighting</li>
          <li>Configurable Monaco Editor options</li>
        </ul>
        <p>Simply add a Custom Code block from the blocks panel and start coding!</p>
      </div>
    </div>

    <script type="text/javascript">
      window.onload = () => {
        // GrapesJS initialization - Monaco Editor loads automatically!
        window.editor = grapesjs.init({
          height: '100%',
          showOffsets: true,
          allowScripts: true,
          noticeOnUnload: false,
          storageManager: false,
          container: '#gjs',
          fromElement: true,

          plugins: ['grapesjs-custom-code-monaco-editor'],
          pluginsOpts: {
            'grapesjs-custom-code-monaco-editor': {
              // Monaco Editor configuration
              monacoOptions: {
                theme: 'vs-dark',
                language: 'html',
                readOnly: false,
                minimap: { enabled: false },
                lineNumbers: 'on',
                wordWrap: 'on',
                fontSize: 14,
                tabSize: 2,
                automaticLayout: true,
                scrollBeyondLastLine: false
              },
              // Monaco Loader configuration (optional)
              monacoLoaderOptions: {
                version: '0.54.0'  // Specify Monaco Editor version
              },
              // Plugin UI configuration
              modalTitle: 'Custom Code Editor',
              buttonLabel: 'Apply Code',
              blockCustomCode: {
                label: 'Custom Code',
                category: 'Code'
              }
            }
          }
        });

        // Listen for Monaco loading events (optional)
        window.editor.on('monaco:load-error', (error) => {
          console.error('Monaco Editor failed to load:', error);
          alert('Failed to load Monaco Editor. Please check your internet connection.');
        });
      };
    </script>
  </body>
</html>
